openapi: "3.0.3"
info:
  title: Bookmarks API
  version: "2.0.0"
  description: A bookmark management API for testing OpenAPI 3.0.3 features

servers:
  - url: https://api.bookmarks.example.com/v2
    description: Production server

paths:
  /bookmarks:
    get:
      operationId: listBookmarks
      summary: List all bookmarks
      description: Retrieve a paginated list of bookmarks with optional filtering
      tags:
        - bookmarks
      parameters:
        - name: tag
          in: query
          description: Filter bookmarks by tag
          required: false
          schema:
            type: string
        - name: cursor
          in: query
          description: Pagination cursor for next page
          schema:
            type: string
        - name: per_page
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 25
            minimum: 1
            maximum: 100
        - name: X-Request-ID
          in: header
          description: Request tracing ID
          schema:
            type: string
      responses:
        "200":
          description: List of bookmarks
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                  next_cursor:
                    type: string
    post:
      operationId: createBookmark
      summary: Create a new bookmark
      description: Add a new bookmark to your collection
      tags:
        - bookmarks
      parameters:
        - name: X-Idempotency-Key
          in: header
          required: true
          description: Unique key for idempotent request
          schema:
            type: string
      requestBody:
        required: true
        description: Bookmark data
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
      responses:
        "201":
          description: Bookmark created
          content:
            application/json:
              schema:
                type: object
        "409":
          description: Duplicate bookmark URL

  /bookmarks/{bookmarkId}:
    parameters:
      - name: bookmarkId
        in: path
        required: true
        description: Unique bookmark identifier
        schema:
          type: string
    get:
      operationId: getBookmark
      summary: Get a bookmark by ID
      tags:
        - bookmarks
      responses:
        "200":
          description: Bookmark details
          content:
            application/json:
              schema:
                type: object
        "404":
          description: Bookmark not found
    put:
      operationId: updateBookmark
      summary: Update a bookmark
      description: Replace all fields of an existing bookmark
      tags:
        - bookmarks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Bookmark updated
          content:
            application/json:
              schema:
                type: object
    delete:
      operationId: deleteBookmark
      summary: Delete a bookmark
      tags:
        - bookmarks
      parameters:
        - name: X-Confirm-Delete
          in: header
          required: true
          description: Confirmation flag for deletion
          schema:
            type: boolean
      responses:
        "204":
          description: Bookmark deleted

  /bookmarks/{bookmarkId}/archive:
    post:
      operationId: archiveBookmark
      summary: Archive a bookmark
      description: Move bookmark to archive
      tags:
        - bookmarks
      parameters:
        - name: bookmarkId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Bookmark archived
          content:
            application/json:
              schema:
                type: object

  /folders:
    get:
      operationId: listFolders
      summary: List bookmark folders
      tags:
        - folders
      parameters:
        - name: include_count
          in: query
          description: Include bookmark count per folder
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: List of folders
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object

  /export:
    get:
      operationId: getExport
      summary: Export bookmarks as file
      description: Export all bookmarks in specified format
      tags:
        - export
      parameters:
        - name: format
          in: query
          required: true
          description: Export format
          schema:
            type: string
            enum:
              - json
              - html
              - csv
      responses:
        "200":
          description: Exported data
          content:
            application/json:
              schema:
                type: object
            text/html:
              schema:
                type: string
            text/csv:
              schema:
                type: string

  /events:
    get:
      operationId: subscribeEvents
      summary: Stream bookmark events
      description: Real-time event stream for bookmark changes
      tags:
        - events
      parameters:
        - name: since
          in: query
          description: Return events since this timestamp
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: Event stream
          content:
            text/event-stream:
              schema:
                type: string
